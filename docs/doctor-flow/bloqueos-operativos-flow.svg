<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1000" viewBox="0 0 1200 1000">
  <defs>
    <style>
      .title { font-family: 'Segoe UI', Arial, sans-serif; font-size: 30px; font-weight: 600; fill: #1F2933; }
      .subtitle { font-family: 'Segoe UI', Arial, sans-serif; font-size: 16px; fill: #52606D; }
      .label { font-family: 'Segoe UI', Arial, sans-serif; font-size: 16px; fill: #102A43; }
      .small { font-family: 'Segoe UI', Arial, sans-serif; font-size: 14px; fill: #52606D; }
      .process { fill: #F2F7FA; stroke: #2F4858; stroke-width: 2; }
      .decision { fill: #FFE8C8; stroke: #C4742C; stroke-width: 2; }
      .start-end { fill: #EAF7F0; stroke: #2F855A; stroke-width: 2; }
      .annotation { fill: #FFFFFF; stroke: #9AA5B1; stroke-width: 1.5; }
      .arrow { stroke: #2F4858; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead); }
      .arrow-soft { stroke: #829AB1; stroke-width: 2; fill: none; marker-end: url(#arrowhead); stroke-dasharray: 6 6; }
    </style>
    <marker id="arrowhead" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L12,6 L0,12 Z" fill="#2F4858"/>
    </marker>
  </defs>

  <rect x="0" y="0" width="1200" height="1000" fill="#F8FAFC"/>
  <rect x="60" y="110" width="1080" height="820" fill="#FFFFFF" stroke="#D9E2EC" stroke-width="2" rx="24" ry="24"/>

  <text x="600" y="70" text-anchor="middle" class="title">Vista de bloqueos operativos</text>
  <text x="600" y="102" text-anchor="middle" class="subtitle">Combina calendario mensual, detalle diario y formulario para bloquear boxes</text>

  <!-- Start -->
  <circle cx="600" cy="170" r="34" class="start-end"/>
  <text x="600" y="170" text-anchor="middle" dominant-baseline="middle" class="label" font-weight="600">Ingreso seccion</text>
  <text x="600" y="200" text-anchor="middle" class="small">Tras revisar reserva de horas</text>

  <!-- Consultar bloqueos -->
  <rect x="470" y="230" width="280" height="90" rx="22" ry="22" class="process"/>
  <text x="610" y="272" text-anchor="middle" class="label">
    <tspan x="610" dy="-10" font-weight="600">Consultar bloqueos vigentes</tspan>
    <tspan x="610" dy="24">`/api/bloqueos` + metadata de sincronizacion</tspan>
  </text>

  <!-- Decision data -->
  <polygon points="610,330 690,390 610,450 530,390" class="decision"/>
  <text x="610" y="390" text-anchor="middle" class="label" font-weight="600">Responde data?</text>
  <text x="684" y="370" class="small" font-weight="600">Si</text>
  <text x="548" y="430" class="small" font-weight="600">No</text>

  <!-- No data -->
  <rect x="260" y="460" width="240" height="90" rx="22" ry="22" class="process"/>
  <text x="380" y="504" text-anchor="middle" class="label">
    <tspan x="380" dy="-10" font-weight="600">Mostrar mensaje de error</tspan>
    <tspan x="380" dy="24">Invita a recargar / contactar soporte</tspan>
  </text>
  <path d="M530 390 H380 V460" class="arrow"/>
  <circle cx="380" cy="580" r="26" class="start-end"/>
  <text x="380" y="580" text-anchor="middle" dominant-baseline="middle" class="label" font-weight="600">Fin</text>

  <!-- Preparar calendario -->
  <rect x="720" y="330" width="300" height="100" rx="22" ry="22" class="process"/>
  <text x="870" y="376" text-anchor="middle" class="label">
    <tspan x="870" dy="-10" font-weight="600">Construir calendario mensual</tspan>
    <tspan x="870" dy="24">Genera matriz 6x7 desde cursor</tspan>
    <tspan x="870" dy="24">Agrupa bloqueos por fecha</tspan>
  </text>

  <!-- UI monthly -->
  <rect x="720" y="460" width="300" height="100" rx="22" ry="22" class="process"/>
  <text x="870" y="506" text-anchor="middle" class="label">
    <tspan x="870" dy="-10" font-weight="600">Renderizar calendario interactivo</tspan>
    <tspan x="870" dy="24">Navegar meses, seleccionar un dia</tspan>
  </text>

  <!-- Decision seleccion -->
  <polygon points="870,570 950,630 870,690 790,630" class="decision"/>
  <text x="870" y="630" text-anchor="middle" class="label" font-weight="600">Dia seleccionado?</text>
  <text x="946" y="610" class="small" font-weight="600">Si</text>
  <text x="812" y="670" class="small" font-weight="600">No</text>

  <!-- No selection -->
  <rect x="600" y="700" width="240" height="90" rx="22" ry="22" class="process"/>
  <text x="720" y="744" text-anchor="middle" class="label">
    <tspan x="720" dy="-10" font-weight="600">Mostrar instructivo</tspan>
    <tspan x="720" dy="24">Mensaje: selecciona un dia para ver bloqueos</tspan>
  </text>
  <path d="M812 630 H720 V700" class="arrow"/>

  <!-- Detalle dia -->
  <rect x="920" y="700" width="240" height="100" rx="22" ry="22" class="process"/>
  <text x="1040" y="748" text-anchor="middle" class="label">
    <tspan x="1040" dy="-10" font-weight="600">Listar bloqueos del dia</tspan>
    <tspan x="1040" dy="24">Box, horario, motivo y sede</tspan>
  </text>
  <path d="M950 630 H1040 V700" class="arrow"/>

  <!-- Form bloqueos -->
  <rect x="440" y="570" width="280" height="120" rx="22" ry="22" class="process"/>
  <text x="580" y="622" text-anchor="middle" class="label">
    <tspan x="580" dy="-10" font-weight="600">Form Bloqueo</tspan>
    <tspan x="580" dy="24">Selecciona box asignado</tspan>
    <tspan x="580" dy="24">Captura motivo y resume bloqueo</tspan>
  </text>

  <!-- Decision valid -->
  <polygon points="580,710 652,760 580,810 508,760" class="decision"/>
  <text x="580" y="760" text-anchor="middle" class="label" font-weight="600">Formulario valido?</text>
  <text x="650" y="742" class="small" font-weight="600">Si</text>
  <text x="520" y="798" class="small" font-weight="600">No</text>

  <!-- Error form -->
  <rect x="340" y="820" width="220" height="90" rx="22" ry="22" class="process"/>
  <text x="450" y="864" text-anchor="middle" class="label">
    <tspan x="450" dy="-10" font-weight="600">Feedback de validacion</tspan>
    <tspan x="450" dy="24">Toast de error: completar datos</tspan>
  </text>
  <path d="M508 760 H450 V820" class="arrow"/>

  <!-- Submit bloqueo -->
  <rect x="660" y="820" width="260" height="90" rx="22" ry="22" class="process"/>
  <text x="790" y="864" text-anchor="middle" class="label">
    <tspan x="790" dy="-10" font-weight="600">Enviar POST `/api/bloqueos`</tspan>
    <tspan x="790" dy="24">Registra bloqueo diario 00:00-23:59</tspan>
  </text>
  <path d="M650 760 H790 V820" class="arrow"/>

  <!-- End -->
  <circle cx="790" cy="940" r="30" class="start-end"/>
  <text x="790" y="940" text-anchor="middle" dominant-baseline="middle" class="label" font-weight="600">Bloqueo registrado</text>
  <text x="790" y="970" text-anchor="middle" class="small">Refresca lista y calendario</text>

  <!-- Connectors -->
  <line x1="600" y1="200" x2="610" y2="230" class="arrow"/>
  <line x1="610" y1="320" x2="610" y2="330" class="arrow"/>
  <path d="M690 390 H720" class="arrow"/>
  <line x1="870" y1="430" x2="870" y2="460" class="arrow"/>
  <line x1="870" y1="560" x2="870" y2="570" class="arrow"/>
  <path d="M720 390 H580 V570" class="arrow"/>
  <line x1="580" y1="690" x2="580" y2="710" class="arrow"/>
  <line x1="790" y1="910" x2="790" y2="940" class="arrow"/>

  <!-- Annotation -->
  <rect x="140" y="270" width="220" height="180" rx="18" ry="18" class="annotation"/>
  <text x="250" y="310" text-anchor="middle" class="label">
    <tspan x="250" dy="-8" font-weight="600">Sincronizacion de datos</tspan>
    <tspan x="250" dy="22">- React Query cache y revalidacion</tspan>
    <tspan x="250" dy="22">- Export CSV para respaldo</tspan>
    <tspan x="250" dy="22">- Recalcula mapa `bloqueosPorFecha`</tspan>
  </text>
  <path d="M360 310 H470" class="arrow-soft"/>

  <rect x="120" y="660" width="220" height="160" rx="18" ry="18" class="annotation"/>
  <text x="230" y="700" text-anchor="middle" class="label">
    <tspan x="230" dy="-8" font-weight="600">Reglas de negocio</tspan>
    <tspan x="230" dy="22">- Solo boxes asignados al doctor</tspan>
    <tspan x="230" dy="22">- Bloqueo full day, sujeto a validacion</tspan>
    <tspan x="230" dy="22">- Toast confirma y limpia formulario</tspan>
  </text>
  <path d="M340 720 H440" class="arrow-soft"/>
</svg>
